<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>zebitype.xyz</title>
  </head>
  <body>
    <main>
      <section id="game">
        <time></time>
        <p></p>
        <input autofocus />
      </section>
    </main>
  </body>
</html>

<script>
  const $time = document.querySelector("time");
  const $paragraph = document.querySelector("p");
  const $input = document.querySelector("input");

  const INITIAL_TIME = 30;

  const TEXT = `the quick brown fox jumps over lazy dog and
  midudev is trying to clone monkey type for fun and profit using
  vanilla js for the typing test speed`;

  let words = [];
  let currentTime = INITIAL_TIME;

  initGame();
  initEvents();

  function initGame() {
    words = TEXT.split(" ").slice(0, 32);
    currentTime = INITIAL_TIME;

    $time.textContent = currentTime;

    $paragraph.innerHTML = words
      .map((word, index) => {
        const letters = word.split("");

        return `<word>
        ${letters.map((letter) => `<letter>${letter}</letter>`).join("")}
      </word>
      `;
      })
      .join("");

    const $firstWord = $paragraph.querySelector("word");
    $firstWord.classList.add("active");
    $firstWord.querySelector("letter").classList.add("active");

    const intervalId = setInterval(() => {
      currentTime--;
      $time.textContent = currentTime;

      if (currentTime === 0) {
        clearInterval(intervalId);
        gameOver();
      }
    }, 1000);
  }

  function initEvents() {
    document.addEventListener("keydown", () => {
      $input.focus();
    });
    $input.addEventListener("keydown", onKeyDown);
    $input.addEventListener("keyup", onKeyUp);
  }

  function onKeyDown() {}

  function onKeyUp() {}

  function gameOver() {}
</script>

<style>
  :root {
    color-scheme: light dark;
    --green: #00b755;
    --yellow: #daaf38;
    --red: #ca4754;
    --black: #222;
    --gray: #999;
  }

  body {
    background: var(--black);
    font-family: monospace;
    display: grid;
    place-content: center;
    padding: 32px;
  }

  letter {
    color: var(--gray);
    position: relative;
  }

  letter.active::before {
    content: "|";
    color: var(--yellow);
    position: absolute;
    left: -60%;
    animation: 1s blink infinite ease-in-out;
  }

  @keyframes blink {
    0%,
    25% {
      opacity: 1;
    }

    75% {
      opacity: 0;
    }
  }
</style>
